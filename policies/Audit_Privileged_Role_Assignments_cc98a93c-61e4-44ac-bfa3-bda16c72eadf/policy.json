{
 "properties": {
  "displayName": "Audit Privileged Role Assignments",
  "policyType": "Custom",
  "mode": "All",
  "metadata": {
   "createdBy": "af3349b7-08a1-42c8-9b4a-446561b6797e",
   "createdOn": "2021-09-21T14:39:28.1888488Z",
   "updatedBy": null,
   "updatedOn": null
  },
  "parameters": {
   "ownerRoleDefId": {
    "type": "String",
    "metadata": {
     "displayName": "Owner Role",
     "description": "Role Definition ID of the Owner Role"
    },
    "defaultValue": "8e3af657-a8ff-443c-a75c-2fe8c4bcb635"
   },
   "ownerGroupId": {
    "type": "String",
    "metadata": {
     "displayName": "Owner AAD Group object ID",
     "description": "Object ID of a group in AAD"
    }
   },
   "contributorRoleDefId": {
    "type": "String",
    "metadata": {
     "displayName": "Contributor Role",
     "description": "Role Definition ID of the Owner Role"
    },
    "defaultValue": "b24988ac-6180-42a0-ab88-20f7382dd24c"
   },
   "contributorGroupId": {
    "type": "String",
    "metadata": {
     "displayName": "Contributor AAD Group object ID",
     "description": "Object ID of a group in AAD"
    }
   },
   "userAccessAdminRoleDefId": {
    "type": "String",
    "metadata": {
     "displayName": "User Access Administrator Role",
     "description": "Role Definition ID of the Owner Role"
    },
    "defaultValue": "18d7d88d-d35e-4fb5-a5c3-7773c20a72d9"
   },
   "userAccessAdminGroupId": {
    "type": "String",
    "metadata": {
     "displayName": "User Access Administrator AAD Group object ID",
     "description": "Object ID of a group in AAD"
    }
   },
   "effect": {
    "type": "String",
    "metadata": {
     "displayName": "Effect",
     "description": "Audit, Deny or Disabled"
    },
    "allowedValues": [
     "Audit",
     "Deny",
     "Disabled"
    ]
   }
  },
  "policyRule": {
   "if": {
    "anyOf": [
     {
      "allOf": [
       {
        "field": "type",
        "equals": "Microsoft.Authorization/roleAssignments"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/roleDefinitionId",
        "contains": "[parameters('ownerRoleDefId')]"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/principalId",
        "notEquals": "[parameters('ownerGroupId')]"
       }
      ]
     },
     {
      "allOf": [
       {
        "field": "type",
        "equals": "Microsoft.Authorization/roleAssignments"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/roleDefinitionId",
        "contains": "[parameters('contributorRoleDefId')]"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/principalId",
        "notEquals": "[parameters('contributorGroupId')]"
       }
      ]
     },
     {
      "allOf": [
       {
        "field": "type",
        "equals": "Microsoft.Authorization/roleAssignments"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/roleDefinitionId",
        "contains": "[parameters('userAccessAdminRoleDefId')]"
       },
       {
        "field": "Microsoft.Authorization/roleAssignments/principalId",
        "notEquals": "[parameters('userAccessAdminGroupId')]"
       }
      ]
     }
    ]
   },
   "then": {
    "effect": "[parameters('effect')]"
   }
  }
 },
 "id": "/subscriptions/0429a4c7-b3c0-4a3c-b8d7-0b2a91e16677/providers/Microsoft.Authorization/policyDefinitions/cc98a93c-61e4-44ac-bfa3-bda16c72eadf",
 "type": "Microsoft.Authorization/policyDefinitions",
 "name": "cc98a93c-61e4-44ac-bfa3-bda16c72eadf"
}